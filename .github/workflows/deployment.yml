name: Deployment-CI/CD

on:
  # Execute this pipeline when we make a pull request to the main branch:
  pull_request:
    branches:
      - "main"
    types: [closed]

jobs:
  # Run the collection CI pipeline
  collection-CI:
    name: collection-CI ðŸš€
    uses: ./.github/workflows/collectionCI.yml

  # Run the trading CI pipeline
  trading-CI:
    name: trading-CI ðŸš€
    #needs: trading-CI  -- if running synchronously
    uses: ./.github/workflows/tradingCI.yml

  # Run the client CI pipeline
  client-CI:
    name: client-CI ðŸš€
    #needs: transport-CI
    uses: ./.github/workflows/clientCI.yml

  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Docker Compose
        run: |
          sudo apt-get update
          sudo apt-get -y install docker-compose

      - name: Build and run containers
        run: |
          docker build -t client:latest -f ./clipper-fe/Dockerfile .
          docker-compose -f ./docker-compose.yml up -d

